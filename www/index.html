<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />
    <!-- Good default declaration:
    * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
    * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
    * Disables use of eval() and inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
        * Enable inline JS: add 'unsafe-inline' to default-src
        * Enable eval(): add 'unsafe-eval' to default-src
    * Create your own at http://cspisawesome.com
    -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->

    <!--
	<link rel="stylesheet" type="text/css" href="css/index.css" />
    -->
	
	<title>Shotgun Triangle</title>
	
	<style type="text/css"> 
		
		/*trying something out for responsive web design, as with the meta tag above*/
		@-ms-viewport
		{
		  width: device-width;
		}
		
		body 
		{
			color: #E9E9E9;
			background-color: black;	
			font-family: "My Custom Font", Robota, Tahoma;
			font-size: 15px;
			/*background-image: url("images/black3.png");*/
		}
	
		.button2 
		{
			color: black;
			background-color: white;
			border: 1px solid white;
			padding: 2px 4px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 18px;
			font-family: 'Abel', sans-serif;
			margin: 4px 2px;
			-webkit-transition-duration: 0.4s; /* Safari */
			transition-duration: 0.4s;
			cursor: pointer;
			height: 40px;
			width: 50px;
			border-radius: 4px;
		}
		
		.button2:hover 
		{
			color: black;
			background-color: orange;			
			border: 1px solid black;
		}
		
		.primaryCanvas 
		{
			/*box-sizing: border-box;*/
			
			/*background:#0e8e39;*/ 
			/*#000;*/
			position:absolute;
			top:10px; /*10px*/
			left: 10px; /*10px*/
			border: 0px solid rgba(0,255,0,.2);
			border-radius: 12px;
			z-index:2;
			/*background-image: radial-gradient(limegreen, darkgreen);*/ /*weird gradient bg*/
		}
		
		.controlDiv
		{
			z-index:3;
			position: absolute;
			top:10;
			left:10;
			border: 1px solid rgba(255,0,0,1);
			border-radius: 12px;
		}
		
	
	</style>
	
</head>

<body onload="hello();">
   
   <!--
   <div class="app">
        
		<h1>Hello Shotgun Triangle</h1>
        <div id="deviceready" class="blink">
            <p class="event listening">Connecting to Device</p>
            <p class="event received">Device is Ready</p>
        </div>
			
    </div>
	-->
	
	<canvas id="primaryCanvas" class="primaryCanvas" onclick="canvasClick(event)"></canvas>
	
	<!--
	
	<div id="controlDiv" class="controlDiv">
		<span id="wth">wth</span> <br />
		<input type ="button" value ="START" style="width:325px;" onclick="doSomething();" class="button2"><br />
	</div>
	-->
	
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript">
        app.initialize();
    </script>
	
	<script>
	
	nX = 0;
	nY = 0;
	
	gamePaused = false;
	
	explosionSheet = new Image();
	explosionSheet.src = "images/explosion_total.png";
	
	ninja = new Image();
	ninja.src = "images/ninja_0.png";
	
	//starScape = new Image();
	//starFog = new Image();
	//starScape.src = "images/newStars2.png";
	//starFog.src = "images/fog2.png"; // starFog
	
	function explosion(pX,pY,t)
	{
		this.frame = 0;
		//this.img = new Image();
		//this.img.src = "images/"+t+"0.png";
		this.x = pX;
		this.y = pY;
		this.type = t;
		this.canvas = "primaryCanvas";
	}
	
	function getDist(x, y, x2, y2)
	{
		x = x2 - x;
		y = y2 - y;
		return Math.floor(Math.sqrt(x * x + y * y));
	}
	
	function wrapText(ctx, text, x, y, maxWidth, lineHeight) 
	{
		var words = text.split(' ');
        var line = '';

        for(var n = 0; n < words.length; n++) 
		{
			var testLine = line + words[n] + ' ';
			var metrics = ctx.measureText(testLine);
			var testWidth = metrics.width;
			if (testWidth > maxWidth && n > 0) 
			{
				ctx.fillText(line, x, y);
				line = words[n] + ' ';
				y += lineHeight;
			}
			else 
			{
				line = testLine;
			}
        }
        ctx.fillText(line, x, y);
    }
	
	function doSomething()
	{
		//alert("heyoo");
	}
	
	function canvasClick(event)
	{
		var x = event.clientX;
		var y = event.clientY;
		//document.getElementById("wth").innerHTML = "yes yes yes yes";
		
		//exp[exp.length] = new explosion(x,y,"exp");
		
		
		
		
		var canvas = document.getElementById('primaryCanvas'); //gameCanvas
		// The canvas context
		var ctx = canvas.getContext('2d');
		// Colors used for the explosion
		//var explosion_colors = ['#FFFF00','#FFD700','#FFFFCC','#FFFF99','#FFFF66','#CCCC00','#999900'];
		var explosion_colors = ['#FFFF00','#FFD700'];
		
		
		
		if(getDist(nX+16,nY+16,x,y)<32)
		{
			nX = Math.random()*(boundingWidth-50);
			nY = Math.random()*(boundingHeight-50);
			playerScore++;
			var explosion_colors = ['blue','aqua','teal'];
		}
		else 
		{
			var explosion_colors = ['#FFFF00','#FFD700'];
		}
		
		// Create a new explosion
		var explo = new ExplosionClass(x, y, explosion_colors,3);
		explo.ctx = ctx;			
		// Add the explosion to the explosions list.
		explosions.push(explo);
		
	}
	
	function hello()
	{
		var w = window,
		d = document,
		e = d.documentElement,
		g = d.getElementsByTagName('body')[0],
		x = w.innerWidth || e.clientWidth || g.clientWidth,
		y = w.innerHeight|| e.clientHeight|| g.clientHeight;
		//alert(x + ' Ã— ' + y);
				
		canvas = document.getElementById("primaryCanvas");
		canvas.width = x-50; //1920
		canvas.height = y-30; //900
		
		boundingWidth = x-50;
		boundingHeight = y-30;
		
		context = document.getElementById('primaryCanvas').getContext('2d');
		
		exp = [];
		
		nX = 0;
		nY = 0;
		playerScore = 0;
		globalTimer = 60;
		starTimer = 0;
		
		
		shipDY = 0;
		shipDX = 0;
		shipX = 10;
		shipY = 10;
		starX = 0;
		starY = 0;
		fogX = 0;
		fogY = 0;
		
		lightningCounter = 0;
		starTimer = 0;
		starX = 0;
		starX_right = 1920;
		fogX = 0;
		fogX_right = 1920;
		backX = 3000;
		
		
	}
	
	function old_drawStars()
	{
	
		
		starX = 0;
		
		document.getElementById('primaryCanvas').getContext('2d').drawImage(starScape, starX, 0);
		document.getElementById('primaryCanvas').getContext('2d').drawImage(starScape, starX_right, 0);
		document.getElementById('primaryCanvas').getContext('2d').drawImage(starFog, fogX, 0);
		document.getElementById('primaryCanvas').getContext('2d').drawImage(starFog, fogX_right, 0);
		//document.getElementById('primaryCanvas').getContext('2d').drawImage(cloudImg, fogX, 0);
		//document.getElementById('primaryCanvas').getContext('2d').drawImage(cloudImg, fogX_right, 0);
		
		//document.getElementById('primaryCanvas').getContext('2d').drawImage(cloudImg, 0, 0);
		
		
		enginesOn = 0.5;
				
		
		if(starTimer == 3)
		{
			starTimer = 0;
			fogX = fogX - (0.3*enginesOn)-0.3 -1;
			fogX_right = fogX_right - (0.3*enginesOn)-0.3 -1; //-2
			
			if(fogX<=-1920)
				fogX=1920;
				
			if(fogX_right<=-1920)
			fogX_right=1920;
		
		}
		
		if(starTimer == 1)
		{
			/*
			starTimer = 0;
			starX_right = starX_right - (0.3*enginesOn);// -0.3;
			starX = starX - (0.3*enginesOn);//-0.3;
			
			if(starX<=-1920)
				starX=1920;
				
			if(starX_right<=-1920)
				starX_right=1920;
			*/			
			
		}
		starTimer = starTimer +1;
	
	}
	
	function drawCanvas()
	{
		
		var canvas = document.getElementById("primaryCanvas");
		var context = document.getElementById("primaryCanvas").getContext('2d');
		context.clearRect(0, 0, canvas.width, canvas.height);
		
		//old_drawStars();
		
		//document.getElementById("primaryCanvas").getContext('2d').drawImage(explosionSheet, 0, 0);
		
		
		document.getElementById("primaryCanvas").getContext('2d').drawImage(ninja, nX, nY);
		
		
		//draw explosions
		for (var i = exp.length-1; i >= 0; i--)
		{
			document.getElementById(exp[i].canvas).getContext('2d').drawImage(explosionSheet, 50*exp[i].frame, 0, 50, 50, exp[i].x, exp[i].y, 50, 50);
			
			exp[i].frame = exp[i].frame + 1;
			if(exp[i].frame==11)
			{
				exp.splice(i,1);
			}
		}
		
		exp_update();
		
		sCurr = "SCORE: " + playerScore;
		var maxWidth = 500;//400
		var lineHeight = 25;
		context.font = '16pt Calibri';
		context.fillStyle = 'white';
		wrapText(context, sCurr, (boundingWidth/2)-50, boundingHeight-100, maxWidth, lineHeight);
		wrapText(context, "TIMER: " +globalTimer, (boundingWidth/2)-50, boundingHeight-70, maxWidth, lineHeight);
		
	}
	
	function update()
	{
		drawCanvas();
		requestAnimationFrame(update);
	}
	
	function timedInterval()
	{
		globalTimer--;
		if(globalTimer < 0)
		{
			hello();
		}
	}
	
	window.addEventListener("load", function()
	{
		update();
	});
	
	window.setInterval(timedInterval, 50000 / 60);
	
	</script>
	
	<script src="rot.js"></script>
	
	<script type="text/javascript" src="core.js"></script>
	<script type="text/javascript" src="explosion_html5.js"></script>
	
</body>

</html>